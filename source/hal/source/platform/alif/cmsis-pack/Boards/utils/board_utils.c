/* Copyright (C) 2025 Alif Semiconductor - All Rights Reserved.
 * Use, distribution and modification of this code is permitted under the
 * terms stated in the Alif Semiconductor Software License Agreement
 *
 * You should have received a copy of the Alif Semiconductor Software
 * License Agreement with this file. If not, please write to:
 * contact@alifsemi.com, or visit: https://alifsemi.com/license
 *
 */

#include "board_utils.h"
#include "board_defs.h"
#include "Driver_IO.h"

extern ARM_DRIVER_GPIO ARM_Driver_GPIO_(BOARD_JOY_SW_D_GPIO_PORT);
extern ARM_DRIVER_GPIO ARM_Driver_GPIO_(BOARD_JOY_SW_CENTER_GPIO_PORT);
extern ARM_DRIVER_GPIO ARM_Driver_GPIO_(BOARD_LEDRGB0_R_GPIO_PORT);
extern ARM_DRIVER_GPIO ARM_Driver_GPIO_(BOARD_LEDRGB1_G_GPIO_PORT);


void BOARD_UTILS_Init()
{
    ARM_DRIVER_GPIO *BOARD_BUTTON1_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_D_GPIO_PORT);
    ARM_DRIVER_GPIO *BOARD_BUTTON2_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_CENTER_GPIO_PORT);
    ARM_DRIVER_GPIO *BOARD_LED1_GPIOdrv = &ARM_Driver_GPIO_(BOARD_LEDRGB0_R_GPIO_PORT);
    ARM_DRIVER_GPIO *BOARD_LED2_GPIOdrv = &ARM_Driver_GPIO_(BOARD_LEDRGB1_G_GPIO_PORT);

    BOARD_BUTTON1_GPIOdrv->Initialize(BOARD_JOY_SW_D_GPIO_PIN, NULL);
    BOARD_BUTTON1_GPIOdrv->PowerControl(BOARD_JOY_SW_D_GPIO_PIN, ARM_POWER_FULL);
    BOARD_BUTTON1_GPIOdrv->SetDirection(BOARD_JOY_SW_D_GPIO_PIN, GPIO_PIN_DIRECTION_INPUT);

    BOARD_BUTTON2_GPIOdrv->Initialize(BOARD_JOY_SW_CENTER_GPIO_PIN, NULL);
    BOARD_BUTTON2_GPIOdrv->PowerControl(BOARD_JOY_SW_CENTER_GPIO_PIN, ARM_POWER_FULL);
    BOARD_BUTTON2_GPIOdrv->SetDirection(BOARD_JOY_SW_CENTER_GPIO_PIN, GPIO_PIN_DIRECTION_INPUT);

    BOARD_LED1_GPIOdrv->Initialize(BOARD_LEDRGB0_R_GPIO_PIN, NULL);
    BOARD_LED1_GPIOdrv->PowerControl(BOARD_LEDRGB0_R_GPIO_PIN, ARM_POWER_FULL);
    BOARD_LED1_GPIOdrv->SetValue(BOARD_LEDRGB0_R_GPIO_PIN, GPIO_PIN_OUTPUT_STATE_LOW);
    BOARD_LED1_GPIOdrv->SetDirection(BOARD_LEDRGB0_R_GPIO_PIN, GPIO_PIN_DIRECTION_OUTPUT);

    BOARD_LED2_GPIOdrv->Initialize(BOARD_LEDRGB1_G_GPIO_PIN, NULL);
    BOARD_LED2_GPIOdrv->PowerControl(BOARD_LEDRGB1_G_GPIO_PIN, ARM_POWER_FULL);
    BOARD_LED2_GPIOdrv->SetValue(BOARD_LEDRGB1_G_GPIO_PIN, GPIO_PIN_OUTPUT_STATE_LOW);
    BOARD_LED2_GPIOdrv->SetDirection(BOARD_LEDRGB1_G_GPIO_PIN, GPIO_PIN_DIRECTION_OUTPUT);
}

void BOARD_BUTTON1_Init(BOARD_Callback_t user_cb)
{
	ARM_DRIVER_GPIO *BOARD_BUTTON1_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_D_GPIO_PORT);
	BOARD_BUTTON1_GPIOdrv->Initialize(BOARD_JOY_SW_D_GPIO_PIN, (ARM_GPIO_SignalEvent_t)user_cb);
}

void BOARD_BUTTON2_Init(BOARD_Callback_t user_cb)
{
	ARM_DRIVER_GPIO *BOARD_BUTTON2_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_CENTER_GPIO_PORT);
	BOARD_BUTTON2_GPIOdrv->Initialize(BOARD_JOY_SW_CENTER_GPIO_PIN, (ARM_GPIO_SignalEvent_t)user_cb);
}

void BOARD_BUTTON1_Control(BOARD_BUTTON_CONTROL control)
{
	uint32_t arg = ARM_GPIO_IRQ_POLARITY_LOW | ARM_GPIO_IRQ_SENSITIVE_EDGE;

	ARM_DRIVER_GPIO *BOARD_BUTTON1_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_D_GPIO_PORT);
	BOARD_BUTTON1_GPIOdrv->Control(BOARD_JOY_SW_D_GPIO_PIN, (GPIO_OPERATION) control, &arg);
}

void BOARD_BUTTON2_Control(BOARD_BUTTON_CONTROL control)
{
	uint32_t arg = ARM_GPIO_IRQ_POLARITY_LOW | ARM_GPIO_IRQ_SENSITIVE_EDGE;

	ARM_DRIVER_GPIO *BOARD_BUTTON2_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_CENTER_GPIO_PORT);
	BOARD_BUTTON2_GPIOdrv->Control(BOARD_JOY_SW_CENTER_GPIO_PIN, (GPIO_OPERATION) control, &arg);
}

void BOARD_BUTTON1_GetState(BOARD_BUTTON_STATE *state)
{
	ARM_DRIVER_GPIO *BOARD_BUTTON1_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_D_GPIO_PORT);
	uint32_t value;
	BOARD_BUTTON1_GPIOdrv->GetValue(BOARD_JOY_SW_D_GPIO_PIN, &value);
	*state = (BOARD_BUTTON_STATE)value;
}

void BOARD_BUTTON2_GetState(BOARD_BUTTON_STATE *state)
{
	ARM_DRIVER_GPIO *BOARD_BUTTON2_GPIOdrv = &ARM_Driver_GPIO_(BOARD_JOY_SW_CENTER_GPIO_PORT);
	uint32_t value;
	BOARD_BUTTON2_GPIOdrv->GetValue(BOARD_JOY_SW_CENTER_GPIO_PIN, &value);
	*state = (BOARD_BUTTON_STATE)value;
}

void BOARD_LED1_Control(BOARD_LED_STATE state)
{
	ARM_DRIVER_GPIO *BOARD_LED1_GPIOdrv = &ARM_Driver_GPIO_(BOARD_LEDRGB0_R_GPIO_PORT);
	BOARD_LED1_GPIOdrv->SetValue(BOARD_LEDRGB0_R_GPIO_PIN, (GPIO_PIN_OUTPUT_STATE) state);
}

void BOARD_LED2_Control(BOARD_LED_STATE state)
{
	ARM_DRIVER_GPIO *BOARD_LED2_GPIOdrv = &ARM_Driver_GPIO_(BOARD_LEDRGB1_G_GPIO_PORT);
	BOARD_LED2_GPIOdrv->SetValue(BOARD_LEDRGB1_G_GPIO_PIN, (GPIO_PIN_OUTPUT_STATE) state);
}
